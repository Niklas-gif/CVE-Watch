//
//  CVEInfoView.swift
//  CVE-Watch
//
//  Created by Niklas Demel on 14.11.23.
//

import SwiftUI

struct CVEInfoView: View {
    @ObservedObject var vm = CVEInfoVM()
    @State var searchText = ""
    var body: some View {
        VStack(alignment:.leading) {
            TextField(
            "CVE-Search", text: $searchText)
            Text("Overview")
                .font(.title)
                .bold()
                .padding()
            Spacer()
            NavigationStack{
                List {
                    ForEach($vm.cves.appCves) {data in
                        NavigationLink(destination: CVEDetailsView()) {
                            CVEListItem(displayData: data)
                        }
                        
                    }
                }
            }
            Button("Test fetch") {
                vm.fetchEntries(userInput: searchText)
            }
            Button("Save") {
                vm.save()
            }
            Button("Load") {
                vm.load()
            }
            Spacer()
        }
    }
}



#Preview {
    CVEInfoView()
}

struct CVEListItem: View {
    @Binding var displayData: Cve
    var body: some View {
        VStack(alignment:.leading) {
            Text(displayData.id)
                .font(.title3)
                .bold()
            HStack {
                Spacer()
                
                Text("BScore: \(displayData.metrics?.cvssMetricV2?[0].cvssData.baseScore ?? 0.0)")
            }
            
        }
        .padding()
        
        .clipShape(.buttonBorder)
    }
}
