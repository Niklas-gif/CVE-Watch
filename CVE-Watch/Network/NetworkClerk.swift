//
//  NetworkClerk.swift
//  CVE-Watch
//
//  Created by Niklas Demel on 16.11.23.
//

import Foundation

//Test
// let cve = try! CVENVDResponse(fromURL: URL(string:"https://services.nvd.nist.gov/rest/json/cves/2.0?cveId=CVE-2019-14287")!)
// let cves = try! CVENVDResponse(fromURL: URL(string:"https://services.nvd.nist.gov/rest/json/cves/2.0/?pubStartDate=2023-11-04T00:00:00.000&pubEndDate=2023-11-13T00:00:00.000")!)
// try! cve.vulnerabilities[0].cve.descriptions[0].jsonString() ?? ""

class ServerFetch {
    
    private let CVE_URL = "https://services.nvd.nist.gov/rest/json/cves/2.0"
    
    func fetchCVE() async -> Vulnerability {
        let TEST_REQUEST = URLRequest(url: URL(string: CVE_URL + "?cveID=CVE-2019-14287")!)
        var (data, response) : (Data, URLResponse)
        do {
            (data, response) = try! await URLSession.shared.data(for: TEST_REQUEST)
        }
        let CVEResponse = try! JSONDecoder().decode(CVENVDResponse.self, from: data)
        print("Response: \(response)")
        return CVEResponse.vulnerabilities[0]
    }
    
}
